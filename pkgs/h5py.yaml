extends: [setuptools_package]

dependencies:
  build: [hdf5, mpi4py, mpi, numpy, cython, pkgconfig, six]
  run: [numpy, mpi4py]

sources:
- key: tar.gz:4ytmmwufq6jb5pd7xdjrusnn37oqxgu2
  url: https://files.pythonhosted.org/packages/74/5d/6f11a5fffc3d8884bb8d6c06abbee0b3d7c8c81bde9819979208ba823a47/h5py-2.8.0.tar.gz

build_stages:
- name: build_ext_options
  mode: replace
  before: install
  handler: bash
  bash: |
       export HDF5_VERSION='1.8.19'
       export CC=${MPICC}
       export CXX=${MPICXX}
       export SETUPTOOLS_PACKAGE_EXTRA_OPTIONS="configure --mpi"
- name: install
  after: setup_dirs
  mode: replace
  handler: bash
  bash: |
       HDF5_VERSION=1.8.19 CC=${MPICC} ${PYTHON} -c 'import setuptools; __file__="setup.py"; exec(open(__file__).read())' \
       ${SETUPTOOLS_PACKAGE_EXTRA_OPTIONS} \
       install \
       --prefix=. --root=${ARTIFACT} \
       --single-version-externally-managed








#extends: [setuptools_package]
#
#dependencies:
#  build: [hdf5, mpi4py, mpi, numpy, cython, pkgconfig, six, pip]
#  run: [numpy, mpi4py]
#
#sources:
# - key: tar.gz:pesugew7fzqvjresr5pdwixxukchw3s7
#   url: https://pypi.python.org/packages/11/6b/32cee6f59e7a03ab7c60bb250caff63e2d20c33ebca47cf8c28f6a2d085c/h5py-2.7.0.tar.gz
#
#build_stages:
#- name: build_ext_options
#  mode: replace
#  before: install
#  handler: bash
#  bash: |
#       export HDF5_VERSION='1.8.16'
#       export CC=${MPICC}
#       export SETUPTOOLS_PACKAGE_EXTRA_OPTIONS="configure --mpi"
#       export INCLUDE_PATH=${INCLUDE_PATH}
